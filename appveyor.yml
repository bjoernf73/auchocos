# AU template: https://github.com/majkinetor/au-packages-template

version: '{build}'
max_jobs: 1
image: Visual Studio 2022
# History plugin requires complete log
#clone_depth: 5
branches:
  only:
  - main
#build:
#  verbosity: minimal

skip_commits:
  files:
    - README.md
    - .gitignore
    - LICENSE

environment:
  # Set au version to use or omit to use the latest. Specify branch name to use development version from Github
  au_version: main # master # 2018.5.18
  au_push: false
  # Force test: use 1 to test all, or N to split testing into N groups
  au_test_groups: 1

  # Github token to commit pushed packages to repository
  github_user_repo: bjoernf73/auchocos
  github_api_key:
    secure: not_set_yet


  # Mail credentials - for error notifications
  # mail_user:
  #   secure: not_set_yet
  # mail_pass:
  #   secure: not_set_yet
  # mail_server: smtp.gmail.com
  # mail_port: 587
  # mail_enablessl: true

  # ID of the gist used to save run results - create a gist under the github_user (secret or not) and grab the id - https://gist.github.com/name/id
  # Optional, leave empty to create anonymous gist
  #gist_id: not_set_yet

  # Force test: gist id for test results
  #gist_id_test:

  # Chocolatey API key - to push updated packages
  #api_key:
  #  secure: not_set_yet

init:
- git config --global user.email "bjornhenrikformo@gmail.com"
- git config --global user.name "bjoernf73"
- git config --global core.safecrlf false

install:
- pwsh: |
    Get-CimInstance win32_operatingsystem -Property Caption, OSArchitecture, Version | fl Caption, OSArchitecture, Version
    $PSVersionTable
    [System.Environment]::OSVersion
- git --version
- choco upgrade chocolatey 
- choco install vt-cli -y
- nuget install -excludeversion
- pwsh: |
    git clone -q https://github.com/bjoernf73/auchocos.git $Env:TEMP/auchocos
    Set-Location $Env:TEMP/auchocos
#    . "./update_all.ps1"

# Uncomment the below line if you are using any of the functions from chocolatey-core.extension - https://chocolatey.org/packages/chocolatey-core.extension. Ensure you also have it listed in your package's dependencies
# - cinst chocolatey-core.extension
    
build_script:
- pwsh: |
    $ErrorActionPreference = 'Stop'
    ./update_all.ps1

#on_finish:
#- pwsh: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
